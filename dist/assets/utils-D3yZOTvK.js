const e=new class{constructor(){this.userActivity=new Map,this.musicMetrics=new Map,this.trends=[],this.recommendations=new Map,this.systemStats={totalUsers:0,totalSongs:0,totalPlays:0,averageRating:0,popularGenres:{},activeUsers:0},this.initializeData()}initializeData(){const e=this.generateMockUserData(),t=this.generateMockMusicData();e.forEach(e=>{this.userActivity.set(e.id,e)}),t.forEach(e=>{this.musicMetrics.set(e.id,e)}),this.generateTrends(),this.updateSystemStats()}generateMockUserData(){const e=[],t=["발라드","엔카","팝","록","재즈","클래식"],a=["한국","일본","미국","독일","프랑스","영국"];for(let r=1;r<=50;r++){const o={id:`user_${r}`,name:`사용자${r}`,joinDate:new Date(2024,Math.floor(12*Math.random()),Math.floor(28*Math.random())),totalSongs:Math.floor(20*Math.random())+1,totalPlays:Math.floor(500*Math.random())+10,averageSessionTime:Math.floor(60*Math.random())+5,favoriteGenres:this.getRandomItems(t,Math.floor(3*Math.random())+1),location:a[Math.floor(Math.random()*a.length)],subscriptionType:Math.random()>.7?"premium":"free",lastActive:new Date(Date.now()-Math.floor(7*Math.random()*24*60*60*1e3)),createdSongs:Math.floor(15*Math.random())+1,sharedSongs:Math.floor(5*Math.random()),rating:(2*Math.random()+3).toFixed(1),engagementScore:Math.floor(100*Math.random())+1};e.push(o)}return e}generateMockMusicData(){const e=[],t=["발라드","엔카","팝","록","재즈","클래식"],a=["행복","슬픔","로맨틱","에너지틱","평온","감성적"];for(let r=1;r<=100;r++){const o={id:`song_${r}`,title:`노래 ${r}`,genre:t[Math.floor(Math.random()*t.length)],mood:a[Math.floor(Math.random()*a.length)],duration:Math.floor(180*Math.random())+120,plays:Math.floor(1e3*Math.random())+50,likes:Math.floor(200*Math.random())+10,shares:Math.floor(50*Math.random())+1,downloads:Math.floor(100*Math.random())+5,rating:(2*Math.random()+3).toFixed(1),createdDate:new Date(2024,Math.floor(12*Math.random()),Math.floor(28*Math.random())),artistId:`user_${Math.floor(50*Math.random())+1}`,completionRate:(.4*Math.random()+.6).toFixed(2),skipRate:(.3*Math.random()).toFixed(2),repeatRate:(.5*Math.random()).toFixed(2),comments:Math.floor(30*Math.random())+1};e.push(o)}return e}generateTrends(){const e=["재생수","좋아요","공유","다운로드","사용자 증가"];["1주","1개월","3개월","6개월","1년"].forEach(t=>{e.forEach(e=>{const a={timeframe:t,metric:e,data:this.generateTrendData(),growth:(40*Math.random()-10).toFixed(1)};this.trends.push(a)})})}generateTrendData(){const e=[];let t=Math.floor(1e3*Math.random())+100;for(let a=0;a<30;a++){const r=.2*(Math.random()-.5);t=Math.max(0,t*(1+r)),e.push({date:new Date(Date.now()-24*(29-a)*60*60*1e3),value:Math.floor(t)})}return e}updateSystemStats(){const e=Array.from(this.userActivity.values()),t=Array.from(this.musicMetrics.values());this.systemStats.totalUsers=e.length,this.systemStats.totalSongs=t.length,this.systemStats.totalPlays=t.reduce((e,t)=>e+t.plays,0),this.systemStats.averageRating=(t.reduce((e,t)=>e+parseFloat(t.rating),0)/t.length).toFixed(1);const a={};t.forEach(e=>{a[e.genre]=(a[e.genre]||0)+e.plays}),this.systemStats.popularGenres=a;const r=new Date(Date.now()-6048e5);this.systemStats.activeUsers=e.filter(e=>e.lastActive>r).length}getUserActivityAnalysis(e=null){if(e)return this.userActivity.get(e);const t=Array.from(this.userActivity.values());return{totalUsers:t.length,activeUsers:t.filter(e=>{const t=new Date(Date.now()-6048e5);return e.lastActive>t}).length,averageSessionTime:(t.reduce((e,t)=>e+t.averageSessionTime,0)/t.length).toFixed(1),premiumUsers:t.filter(e=>"premium"===e.subscriptionType).length,topUsers:t.sort((e,t)=>t.engagementScore-e.engagementScore).slice(0,10),userGrowth:this.calculateUserGrowth(t),engagementDistribution:this.calculateEngagementDistribution(t)}}getMusicPerformanceMetrics(e=null){if(e)return this.musicMetrics.get(e);const t=Array.from(this.musicMetrics.values());return{totalSongs:t.length,totalPlays:t.reduce((e,t)=>e+t.plays,0),averageRating:(t.reduce((e,t)=>e+parseFloat(t.rating),0)/t.length).toFixed(1),topSongs:t.sort((e,t)=>t.plays-e.plays).slice(0,10),genreDistribution:this.calculateGenreDistribution(t),moodDistribution:this.calculateMoodDistribution(t),performanceMetrics:{averageCompletion:(t.reduce((e,t)=>e+parseFloat(t.completionRate),0)/t.length).toFixed(2),averageSkipRate:(t.reduce((e,t)=>e+parseFloat(t.skipRate),0)/t.length).toFixed(2),averageRepeatRate:(t.reduce((e,t)=>e+parseFloat(t.repeatRate),0)/t.length).toFixed(2)}}}getTrendAnalysis(e="1개월",t="재생수"){const a=this.trends.find(a=>a.timeframe===e&&a.metric===t);return a?{...a,summary:{currentValue:a.data[a.data.length-1].value,previousValue:a.data[0].value,change:a.growth,peak:Math.max(...a.data.map(e=>e.value)),trough:Math.min(...a.data.map(e=>e.value))}}:null}generatePersonalizedRecommendations(e){const t=this.userActivity.get(e);if(!t)return[];const a=Array.from(this.musicMetrics.values()),r=t.favoriteGenres;let o=a.filter(e=>r.includes(e.genre));return o=o.map(e=>({...e,recommendationScore:this.calculateRecommendationScore(e,t)})),o.sort((e,t)=>t.recommendationScore-e.recommendationScore),o.slice(0,10).map(e=>({id:e.id,title:e.title,genre:e.genre,mood:e.mood,rating:e.rating,plays:e.plays,recommendationScore:e.recommendationScore.toFixed(2),reason:this.getRecommendationReason(e,t)}))}calculateRecommendationScore(e,t){let a=0;t.favoriteGenres.includes(e.genre)&&(a+=40),a+=e.plays/1e3*30,a+=parseFloat(e.rating)/5*20;const r=(Date.now()-e.createdDate.getTime())/864e5;return a+=10*Math.max(0,(30-r)/30),a}getRecommendationReason(e,t){const a=[];t.favoriteGenres.includes(e.genre)&&a.push(`선호하는 ${e.genre} 장르`),e.plays>500&&a.push("인기 곡"),parseFloat(e.rating)>=4.5&&a.push("높은 평점");return(Date.now()-e.createdDate.getTime())/864e5<=7&&a.push("신곡"),a.join(", ")||"추천 곡"}getRandomItems(e,t){return[...e].sort(()=>.5-Math.random()).slice(0,t)}calculateUserGrowth(e){const t=new Date;t.setMonth(t.getMonth()-1);const a=e.filter(e=>e.joinDate>t).length,r=e.filter(e=>e.joinDate<=t).length;return 0===r?100:(a/r*100).toFixed(1)}calculateEngagementDistribution(e){return{high:e.filter(e=>e.engagementScore>=80).length,medium:e.filter(e=>e.engagementScore>=50&&e.engagementScore<80).length,low:e.filter(e=>e.engagementScore<50).length}}calculateGenreDistribution(e){const t={};return e.forEach(e=>{t[e.genre]=(t[e.genre]||0)+1}),t}calculateMoodDistribution(e){const t={};return e.forEach(e=>{t[e.mood]=(t[e.mood]||0)+1}),t}updateRealTimeStats(){return this.updateSystemStats(),this.systemStats}generateCustomReport(e={}){const{timeframe:t="1개월",metrics:a=["사용자","재생수","평점"],groupBy:r="genre"}=e,o=Array.from(this.musicMetrics.values()),n=Array.from(this.userActivity.values()),s={title:`${t} 커스텀 리포트`,generatedAt:new Date,timeframe:t,metrics:a,groupBy:r,data:{},summary:{}};if("genre"===r){[...new Set(o.map(e=>e.genre))].forEach(e=>{const t=o.filter(t=>t.genre===e);s.data[e]={songCount:t.length,totalPlays:t.reduce((e,t)=>e+t.plays,0),averageRating:(t.reduce((e,t)=>e+parseFloat(t.rating),0)/t.length).toFixed(1),totalLikes:t.reduce((e,t)=>e+t.likes,0)}})}return s.summary={totalUsers:n.length,totalSongs:o.length,totalPlays:o.reduce((e,t)=>e+t.plays,0),averageRating:(o.reduce((e,t)=>e+parseFloat(t.rating),0)/o.length).toFixed(1)},s}};export{e as a};
